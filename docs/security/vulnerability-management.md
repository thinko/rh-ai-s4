# Vulnerability Management

Current audit status and dependency management policy for S4.

## Latest Audit Status

**Last Updated**: 2026-02-24

### Summary

- **Backend**: 6 vulnerabilities (0 Critical, 0 High, 3 Moderate, 3 Low)
- **Frontend**: 1-5 vulnerabilities (0 High, 1 Moderate documented, 0-4 Low)
- **Overall Improvement**: 94% reduction from initial audit (19 → 6-11 total)

All remaining vulnerabilities are LOW or MODERATE severity in optional development dependencies.

## Resolved Vulnerabilities (2026-01-29)

### Backend Remediations

#### 1. Removed @kubernetes/client-node (v0.12.2)

- **Impact**: Eliminated 2 CRITICAL SSRF vulnerabilities
- **CVE**: CVE-2023-28155
- **Additional**: Removed 4 HIGH severity vulnerabilities
- **Reason**: Package was unused in codebase (zero imports)
- **Transitive**: Also removed vulnerabilities in `request`, `form-data`, `qs`, `tar`

#### 2. Updated @fastify/multipart (v7.7.3 → v8.3.1)

- **Impact**: Fixed resource exhaustion vulnerability
- **CVE**: CVE-2025-24033 (GHSA-27c6-mcxv-x3fh)
- **Severity**: HIGH (CVSS 7.5)
- **Issue**: Resource exhaustion in `saveRequestFiles` function
- **Compatibility**: Compatible with Fastify 5.x
- **Testing**: Upload functionality verified via automated tests

#### 3. Updated TypeScript ESLint (v7.1.1 → v8.54.0)

- **Impact**: Eliminated 8 MODERATE severity vulnerabilities
- **Packages**: `@typescript-eslint/eslint-plugin` and `@typescript-eslint/parser`
- **Config**: Removed deprecated `prettier/@typescript-eslint` configuration
- **Fix**: Updated `.eslintrc` to remove deprecated `tsconfigRootDir` path

#### 4. Updated Test Dependencies

- **Impact**: Fixed 4 LOW severity vulnerabilities in `diff` package
- **Packages**: Updated `jest` and `ts-jest`
- **Addition**: Added `form-data` as direct dev dependency for multipart tests

### Frontend Remediations

#### 1. Removed react-docgen-typescript-loader

- **Impact**: Eliminated 14 vulnerabilities
- **Reason**: Unused development dependency
- **Fixed**: braces, micromatch, chokidar, watchpack-chokidar2, anymatch, readdirp
- **Environment**: Build-time only (development dependencies)

#### 2. Updated React Router (7.9.6 → 7.13.0)

- **Impact**: Fixed 3 HIGH/MODERATE vulnerabilities
- **CVEs**:
  - **GHSA-h5cw-625j-3rxh**: CSRF in Action/Server Processing (MODERATE, CVSS 6.5)
  - **GHSA-2w69-qvjg-hvjx**: XSS via Open Redirects (HIGH, CVSS 8.0)
  - **GHSA-8v8x-cx79-35w7**: SSR XSS in ScrollRestoration (HIGH, CVSS 8.2)
- **Environment**: Runtime security improvements

#### 3. Updated Transitive Dependencies

- **Impact**: Fixed 8 additional vulnerabilities
- **Packages**:
  - lodash: Prototype Pollution (MODERATE)
  - node-forge: ASN.1 vulnerabilities (HIGH - 3 CVEs)
  - qs: DoS via memory exhaustion (HIGH)
  - express, body-parser: Transitive qs dependency (HIGH)
- **Environment**: Build-time and development server

### Backend Remediations (2026-02-24)

#### 1. Upgraded Fastify (v4.28.1 → v5.7.2+)

- **Impact**: Fixed Content-Type validation bypass
- **CVE**: CVE-2026-25223
- **Severity**: HIGH (CVSS 7.5)
- **Issue**: Tab character in Content-Type header allows complete body validation bypass
- **Breaking Changes**:
  - Node.js 20+ required (updated from 18)
  - All @fastify/* plugins updated to Fastify 5-compatible major versions
  - DELETE requests with Content-Type header and empty body now rejected
- **Fixes Applied**:
  - Frontend apiClient interceptor strips Content-Type on bodyless DELETE requests
  - server.ts hooks converted from callback to async pattern
  - Route-level onResponse hooks converted to async
  - @types/node updated from ^18.14.5 to ^20.17.0
  - Dockerfile updated to Node.js 20 builder and runtime
- **Testing**: Full test suite, manual verification of DELETE operations and SSE streaming

## Remaining Vulnerabilities

### Frontend: ESLint (Accepted Technical Debt)

**Package**: eslint v8.9.0
**CVE**: GHSA-p5wg-g6qr-c7cg
**Severity**: MODERATE (CVSS 5.5)
**Issue**: Stack overflow when serializing objects with circular references

**Exploitability**: LOW

- Requires local file system access
- Requires crafted code with circular references
- No known active exploits in the wild

**Mitigation Strategy**:

- Blocked by `@redhat-cloud-services/eslint-config-redhat-cloud-services@2.0.12` compatibility
- Upgrading to eslint v9 requires breaking changes and extensive config migration
- Will be addressed when RedHat releases compatible v3.x config or during future eslint migration

**Production Impact**: NONE (development-only tool, not included in production build)

**Decision Date**: 2026-01-29
**Review Date**: Next scheduled dependency audit (Q2 2026)

### Backend: tmp (Low Severity)

**Package**: tmp (transitive via eslint → inquirer → external-editor)
**Severity**: 3 LOW
**Issue**: Symbolic link directory write vulnerability
**Status**: Will be fixed with ESLint v9 upgrade

## Audit History

| Date                | Total Vulns | Critical | High | Moderate | Low | Action Taken         |
| ------------------- | ----------- | -------- | ---- | -------- | --- | -------------------- |
| 2026-01-29 (Before) | 23          | 2        | 11   | 7        | 3   | Initial audit        |
| 2026-01-29 (After)  | 6-11        | 0        | 0    | 3-4      | 3-7 | Remediation complete |
| 2026-02-24          | 6-11        | 0        | 0    | 3-4      | 3-7 | Fastify 5 upgrade (CVE-2026-25223) |

**Current Status**: 0 CRITICAL, 0 HIGH, 3-4 MODERATE, 3-7 LOW

## Deferred Updates

### ESLint v9 Migration

**Current**: v8.57.0
**Target**: v9.39.2
**Risk**: HIGH (requires flat config migration, extensive breaking changes)
**Severity**: MODERATE (ReDoS vulnerability in dev tooling)
**Recommendation**: Plan dedicated migration project for Q2 2026
**Effort**: ~3-5 days

**Migration Requirements**:

- Convert to flat config format
- Update all eslint plugins
- Update CI/CD pipeline
- Update developer documentation
- Test across all environments

## Dependency Update Policy

S4 follows these practices for dependency management:

### 1. Regular Audits

- Run `npm audit` before each release
- Review dependency alerts weekly
- Monitor GitHub Dependabot alerts

### 2. Priority Levels

**Critical/High** (Immediate):

- Address within 24-48 hours
- Emergency release if in production
- Document if blocking issue

**Moderate** (Within Release Cycle):

- Address in next release cycle
- Document if blocked by dependencies
- Evaluate workarounds

**Low** (Case-by-Case):

- Review based on exploitability
- Document if accepted as technical debt
- Plan remediation in future releases

### 3. Breaking Changes

- Evaluate carefully before applying
- Test thoroughly in development
- Prefer gradual migration paths
- Document breaking changes

### 4. Development vs Production

- Prioritize production dependency fixes
- Dev dependencies evaluated by impact
- Consider separate dev/prod audits

## Running Security Audits

### Backend

```bash
cd backend

# Run npm audit
npm audit

# Audit with fix suggestions
npm audit fix

# Audit with breaking changes
npm audit fix --force

# Generate audit report
npm audit --json > audit-report.json
```

### Frontend

```bash
cd frontend

# Run npm audit
npm audit

# Audit with fix suggestions
npm audit fix

# Audit with breaking changes
npm audit fix --force

# Generate audit report
npm audit --json > audit-report.json
```

### Full Project

```bash
# From project root
npm run audit:all

# Or manually
npm audit --workspaces
```

## Container Image Scanning

### Trivy

```bash
# Scan built image
trivy image quay.io/rh-aiservices-bu/s4:latest

# Scan with severity filter
trivy image --severity HIGH,CRITICAL quay.io/rh-aiservices-bu/s4:latest

# Generate report
trivy image --format json quay.io/rh-aiservices-bu/s4:latest > trivy-report.json
```

### Snyk

```bash
# Scan dependencies
snyk test

# Scan container image
snyk container test quay.io/rh-aiservices-bu/s4:latest

# Monitor project
snyk monitor
```

## Vulnerability Disclosure

### Reporting Process

1. **Discovery**: Vulnerability identified (internal or external)
2. **Assessment**: Evaluate severity and impact
3. **Fix Development**: Develop and test patch
4. **Testing**: Verify fix resolves issue
5. **Release**: Deploy fixed version
6. **Disclosure**: Publish security advisory

### Timeline

- **Acknowledgment**: Within 48 hours
- **Assessment**: Within 1 week
- **Fix Development**: Varies by severity
- **Coordinated Disclosure**: After fix released

## Security Advisory Template

```markdown
## Security Advisory: [TITLE]

**CVE**: CVE-YYYY-NNNNN (if assigned)
**Severity**: [Critical|High|Moderate|Low]
**CVSS Score**: X.X
**Affected Versions**: vX.X.X - vY.Y.Y
**Fixed in**: vZ.Z.Z

### Description

[Description of vulnerability]

### Impact

[What can an attacker do?]

### Patches

Upgrade to version vZ.Z.Z or later.

### Workarounds

[Any workarounds if patches not available]

### References

- [Link to CVE]
- [Link to fix PR]

### Credits

[Credit to reporter]
```

## Related Documentation

- [Security Policy](./README.md) - Overall security policy
- [Authentication](./authentication.md) - Authentication system
- [Best Practices](./best-practices.md) - Security recommendations
- [Production Readiness](../deployment/production-readiness.md) - Production checklist
